
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>analyzer: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">web-page-analyzer/analyzer/analyzer.go (77.4%)</option>
				
				<option value="file1">web-page-analyzer/handlers/handlers.go (73.9%)</option>
				
				<option value="file2">web-page-analyzer/main.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package analyzer

import (
        "fmt"
        "io"
        "log"
        "net/http"
        "net/url"
        "os"
        "strings"
        "time"

        "golang.org/x/net/html"
)

type AnalysisResult struct {
        URL               string            `json:"url"`
        HTMLVersion       string            `json:"html_version"`
        PageTitle         string            `json:"page_title"`
        HeadingCounts     map[string]int    `json:"heading_counts"`
        InternalLinks     int               `json:"internal_links"`
        ExternalLinks     int               `json:"external_links"`
        InaccessibleLinks int               `json:"inaccessible_links"`
        HasLoginForm      bool              `json:"has_login_form"`
        Error             string            `json:"error,omitempty"`
        StatusCode        int               `json:"status_code,omitempty"`
}

type Analyzer struct {
        httpClient *http.Client
        timeout    time.Duration
        logger     *log.Logger
}

func NewAnalyzer(timeout time.Duration) *Analyzer <span class="cov8" title="1">{
        return &amp;Analyzer{
                httpClient: &amp;http.Client{
                        Timeout: timeout,
                },
                timeout: timeout,
                logger:  log.New(os.Stdout, "analyzer ", log.LstdFlags),
        }
}</span>

// SetLogger allows tests or callers to provide a custom logger
func (a *Analyzer) SetLogger(logger *log.Logger) <span class="cov0" title="0">{
        if logger != nil </span><span class="cov0" title="0">{
                a.logger = logger
        }</span>
}

func (a *Analyzer) AnalyzeURL(targetURL string) *AnalysisResult <span class="cov8" title="1">{
        result := &amp;AnalysisResult{
                URL:           targetURL,
                HeadingCounts: make(map[string]int),
        }

        overallStart := time.Now()
        if a.logger != nil </span><span class="cov8" title="1">{
                a.logger.Printf("analyze_start url=%q", targetURL)
        }</span>

        <span class="cov8" title="1">parsedURL, err := url.Parse(targetURL)
        if err != nil </span><span class="cov8" title="1">{
                // If parsing failed and there's no scheme, try normalizing with https://
                if !strings.Contains(targetURL, "://") </span><span class="cov8" title="1">{
                        normalized := "https://" + targetURL
                        parsedURL, err = url.Parse(normalized)
                        if err != nil </span><span class="cov0" title="0">{
                                result.Error = fmt.Sprintf("Invalid URL: %v", err)
                                if a.logger != nil </span><span class="cov0" title="0">{
                                        a.logger.Printf("invalid_url url=%q err=%v", targetURL, err)
                                }</span>
                                <span class="cov0" title="0">return result</span>
                        }
                        <span class="cov8" title="1">if a.logger != nil </span><span class="cov8" title="1">{
                                a.logger.Printf("url_normalized url=%q", normalized)
                        }</span>
                        <span class="cov8" title="1">targetURL = normalized</span>
                } else<span class="cov0" title="0"> {
                        result.Error = fmt.Sprintf("Invalid URL: %v", err)
                        if a.logger != nil </span><span class="cov0" title="0">{
                                a.logger.Printf("invalid_url url=%q err=%v", targetURL, err)
                        }</span>
                        <span class="cov0" title="0">return result</span>
                }
        }

        <span class="cov8" title="1">if parsedURL.Scheme == "" </span><span class="cov8" title="1">{
                targetURL = "https://" + targetURL
                parsedURL, err = url.Parse(targetURL)
                if err != nil </span><span class="cov0" title="0">{
                        result.Error = fmt.Sprintf("Invalid URL: %v", err)
                        if a.logger != nil </span><span class="cov0" title="0">{
                                a.logger.Printf("invalid_url_after_normalize url=%q err=%v", targetURL, err)
                        }</span>
                        <span class="cov0" title="0">return result</span>
                }
                <span class="cov8" title="1">if a.logger != nil </span><span class="cov8" title="1">{
                        a.logger.Printf("url_normalized url=%q", targetURL)
                }</span>
        }

        <span class="cov8" title="1">reqStart := time.Now()
        resp, err := a.httpClient.Get(targetURL)
        if err != nil </span><span class="cov8" title="1">{
                result.Error = fmt.Sprintf("Failed to fetch URL: %v", err)
                if a.logger != nil </span><span class="cov8" title="1">{
                        a.logger.Printf("http_get_error url=%q ms=%d err=%v", targetURL, time.Since(reqStart).Milliseconds(), err)
                }</span>
                <span class="cov8" title="1">return result</span>
        }
        <span class="cov8" title="1">defer resp.Body.Close()

        result.StatusCode = resp.StatusCode
        if resp.StatusCode &gt;= 400 </span><span class="cov8" title="1">{
                result.Error = fmt.Sprintf("HTTP %d: %s", resp.StatusCode, http.StatusText(resp.StatusCode))
                if a.logger != nil </span><span class="cov8" title="1">{
                        a.logger.Printf("http_status_error url=%q status=%d ms=%d", targetURL, resp.StatusCode, time.Since(reqStart).Milliseconds())
                }</span>
                <span class="cov8" title="1">return result</span>
        }

        <span class="cov8" title="1">body, err := io.ReadAll(resp.Body)
        if err != nil </span><span class="cov0" title="0">{
                result.Error = fmt.Sprintf("Failed to read response body: %v", err)
                if a.logger != nil </span><span class="cov0" title="0">{
                        a.logger.Printf("read_body_error url=%q err=%v", targetURL, err)
                }</span>
                <span class="cov0" title="0">return result</span>
        }
        <span class="cov8" title="1">if a.logger != nil </span><span class="cov8" title="1">{
                a.logger.Printf("http_get_ok url=%q status=%d ms=%d bytes=%d", targetURL, resp.StatusCode, time.Since(reqStart).Milliseconds(), len(body))
        }</span>

        <span class="cov8" title="1">parseStart := time.Now()
        doc, err := html.Parse(strings.NewReader(string(body)))
        if err != nil </span><span class="cov0" title="0">{
                result.Error = fmt.Sprintf("Failed to parse HTML: %v", err)
                if a.logger != nil </span><span class="cov0" title="0">{
                        a.logger.Printf("html_parse_error url=%q err=%v", targetURL, err)
                }</span>
                <span class="cov0" title="0">return result</span>
        }
        <span class="cov8" title="1">if a.logger != nil </span><span class="cov8" title="1">{
                a.logger.Printf("html_parse_ok url=%q ms=%d", targetURL, time.Since(parseStart).Milliseconds())
        }</span>

        <span class="cov8" title="1">a.analyzeDocument(doc, result, parsedURL, string(body))
        if a.logger != nil </span><span class="cov8" title="1">{
                a.logger.Printf(
                        "analyze_done url=%q total_ms=%d internal=%d external=%d inaccessible=%d headings=%d login_form=%t html_version=%q title_len=%d",
                        targetURL,
                        time.Since(overallStart).Milliseconds(),
                        result.InternalLinks,
                        result.ExternalLinks,
                        result.InaccessibleLinks,
                        len(result.HeadingCounts),
                        result.HasLoginForm,
                        result.HTMLVersion,
                        len(result.PageTitle),
                )
        }</span>
        <span class="cov8" title="1">return result</span>
}

func (a *Analyzer) analyzeDocument(doc *html.Node, result *AnalysisResult, baseURL *url.URL, htmlContent string) <span class="cov8" title="1">{
        result.HTMLVersion = a.detectHTMLVersion(htmlContent)
        if a.logger != nil </span><span class="cov8" title="1">{
                a.logger.Printf("html_version_detected url=%q version=%q", result.URL, result.HTMLVersion)
        }</span>

        <span class="cov8" title="1">var traverse func(*html.Node)
        var links []string

        traverse = func(n *html.Node) </span><span class="cov8" title="1">{
                if n.Type == html.ElementNode </span><span class="cov8" title="1">{
                        switch n.Data </span>{
                        case "title":<span class="cov8" title="1">
                                if n.FirstChild != nil &amp;&amp; n.FirstChild.Type == html.TextNode </span><span class="cov8" title="1">{
                                        result.PageTitle = strings.TrimSpace(n.FirstChild.Data)
                                }</span>
                        case "h1", "h2", "h3", "h4", "h5", "h6":<span class="cov8" title="1">
                                result.HeadingCounts[n.Data]++</span>
                        case "a":<span class="cov8" title="1">
                                for _, attr := range n.Attr </span><span class="cov8" title="1">{
                                        if attr.Key == "href" &amp;&amp; attr.Val != "" </span><span class="cov8" title="1">{
                                                links = append(links, attr.Val)
                                        }</span>
                                }
                        case "form":<span class="cov8" title="1">
                                if a.isLoginForm(n) </span><span class="cov8" title="1">{
                                        result.HasLoginForm = true
                                }</span>
                        }
                }

                <span class="cov8" title="1">for c := n.FirstChild; c != nil; c = c.NextSibling </span><span class="cov8" title="1">{
                        traverse(c)
                }</span>
        }

        <span class="cov8" title="1">traverse(doc)
        a.analyzeLinks(links, baseURL, result)</span>
}

func (a *Analyzer) detectHTMLVersion(htmlContent string) string <span class="cov8" title="1">{
        htmlContent = strings.TrimSpace(strings.ToLower(htmlContent))
        
        if strings.Contains(htmlContent, "&lt;!doctype html&gt;") </span><span class="cov8" title="1">{
                return "HTML5"
        }</span>
        
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd xhtml 1.1//en"`) </span><span class="cov0" title="0">{
                return "XHTML 1.1"
        }</span>
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd xhtml 1.0 strict//en"`) </span><span class="cov8" title="1">{
                return "XHTML 1.0 Strict"
        }</span>
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd xhtml 1.0 transitional//en"`) </span><span class="cov0" title="0">{
                return "XHTML 1.0 Transitional"
        }</span>
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd xhtml 1.0 frameset//en"`) </span><span class="cov0" title="0">{
                return "XHTML 1.0 Frameset"
        }</span>
        
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd html 4.01//en"`) </span><span class="cov0" title="0">{
                return "HTML 4.01 Strict"
        }</span>
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd html 4.01 transitional//en"`) </span><span class="cov8" title="1">{
                return "HTML 4.01 Transitional"
        }</span>
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd html 4.01 frameset//en"`) </span><span class="cov0" title="0">{
                return "HTML 4.01 Frameset"
        }</span>
        
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//w3c//dtd html 3.2 final//en"`) </span><span class="cov0" title="0">{
                return "HTML 3.2"
        }</span>
        
        <span class="cov8" title="1">if strings.Contains(htmlContent, `"-//ietf//dtd html 2.0//en"`) </span><span class="cov0" title="0">{
                return "HTML 2.0"
        }</span>
        
        <span class="cov8" title="1">return "Unknown"</span>
}

func (a *Analyzer) analyzeLinks(links []string, baseURL *url.URL, result *AnalysisResult) <span class="cov8" title="1">{
        start := time.Now()
        total := 0
        skipped := 0
        for _, link := range links </span><span class="cov8" title="1">{
                link = strings.TrimSpace(link)
                if link == "" || strings.HasPrefix(link, "#") || strings.HasPrefix(link, "javascript:") || strings.HasPrefix(link, "mailto:") || strings.HasPrefix(link, "tel:") </span><span class="cov8" title="1">{
                        skipped++
                        continue</span>
                }

                <span class="cov8" title="1">parsedLink, err := url.Parse(link)
                if err != nil </span><span class="cov0" title="0">{
                        if a.logger != nil </span><span class="cov0" title="0">{
                                a.logger.Printf("link_parse_error base=%q link=%q err=%v", baseURL.String(), link, err)
                        }</span>
                        <span class="cov0" title="0">continue</span>
                }

                <span class="cov8" title="1">resolvedLink := baseURL.ResolveReference(parsedLink)
                total++
                
                if resolvedLink.Host == baseURL.Host </span><span class="cov8" title="1">{
                        result.InternalLinks++
                }</span> else<span class="cov8" title="1"> {
                        result.ExternalLinks++
                }</span>

                <span class="cov8" title="1">if !a.isLinkAccessible(resolvedLink.String()) </span><span class="cov8" title="1">{
                        result.InaccessibleLinks++
                }</span>
        }
        <span class="cov8" title="1">if a.logger != nil </span><span class="cov8" title="1">{
                a.logger.Printf("links_analyzed url=%q total=%d skipped=%d internal=%d external=%d inaccessible=%d ms=%d", result.URL, total, skipped, result.InternalLinks, result.ExternalLinks, result.InaccessibleLinks, time.Since(start).Milliseconds())
        }</span>
}

func (a *Analyzer) isLinkAccessible(link string) bool <span class="cov8" title="1">{
        req, err := http.NewRequest("HEAD", link, nil)
        if err != nil </span><span class="cov0" title="0">{
                if a.logger != nil </span><span class="cov0" title="0">{
                        a.logger.Printf("link_head_build_error link=%q err=%v", link, err)
                }</span>
                <span class="cov0" title="0">return false</span>
        }

        <span class="cov8" title="1">resp, err := a.httpClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                if a.logger != nil </span><span class="cov0" title="0">{
                        a.logger.Printf("link_head_error link=%q err=%v", link, err)
                }</span>
                <span class="cov0" title="0">return false</span>
        }
        <span class="cov8" title="1">defer resp.Body.Close()

        if resp.StatusCode &gt;= 400 </span><span class="cov8" title="1">{
                if a.logger != nil </span><span class="cov8" title="1">{
                        a.logger.Printf("link_inaccessible link=%q status=%d", link, resp.StatusCode)
                }</span>
                <span class="cov8" title="1">return false</span>
        }
        <span class="cov8" title="1">return true</span>
}

func (a *Analyzer) isLoginForm(formNode *html.Node) bool <span class="cov8" title="1">{
        hasPasswordField := false
        hasUsernameField := false
        
        var traverse func(*html.Node)
        traverse = func(n *html.Node) </span><span class="cov8" title="1">{
                if n.Type == html.ElementNode &amp;&amp; n.Data == "input" </span><span class="cov8" title="1">{
                        var inputType, inputName string
                        for _, attr := range n.Attr </span><span class="cov8" title="1">{
                                switch attr.Key </span>{
                                case "type":<span class="cov8" title="1">
                                        inputType = strings.ToLower(attr.Val)</span>
                                case "name":<span class="cov8" title="1">
                                        inputName = strings.ToLower(attr.Val)</span>
                                }
                        }
                        
                        <span class="cov8" title="1">if inputType == "password" </span><span class="cov8" title="1">{
                                hasPasswordField = true
                        }</span>
                        
                        <span class="cov8" title="1">if inputType == "email" || inputType == "text" || inputType == "" </span><span class="cov8" title="1">{
                                if strings.Contains(inputName, "user") || 
                                   strings.Contains(inputName, "login") || 
                                   strings.Contains(inputName, "email") </span><span class="cov8" title="1">{
                                        hasUsernameField = true
                                }</span>
                        }
                }
                
                <span class="cov8" title="1">for c := n.FirstChild; c != nil; c = c.NextSibling </span><span class="cov8" title="1">{
                        traverse(c)
                }</span>
        }
        
        <span class="cov8" title="1">traverse(formNode)
        return hasPasswordField &amp;&amp; hasUsernameField</span>
}</pre>
		
		<pre class="file" id="file1" style="display: none">package handlers

import (
        "encoding/json"
        "html/template"
        "log"
        "net/http"
        "time"

        "web-page-analyzer/analyzer"
)

type Server struct {
        analyzer *analyzer.Analyzer
        template *template.Template
}

func NewServer() *Server <span class="cov8" title="1">{
        tmpl := template.Must(template.New("index").Parse(indexHTML))
        
        return &amp;Server{
                analyzer: analyzer.NewAnalyzer(30 * time.Second),
                template: tmpl,
        }
}</span>

func (s *Server) IndexHandler(w http.ResponseWriter, r *http.Request) <span class="cov8" title="1">{
        if r.Method != http.MethodGet </span><span class="cov8" title="1">{
                http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
                return
        }</span>
        
        <span class="cov8" title="1">w.Header().Set("Content-Type", "text/html")
        if err := s.template.Execute(w, nil); err != nil </span><span class="cov0" title="0">{
                log.Printf("Template execution error: %v", err)
                http.Error(w, "Internal Server Error", http.StatusInternalServerError)
                return
        }</span>
}

func (s *Server) AnalyzeHandler(w http.ResponseWriter, r *http.Request) <span class="cov8" title="1">{
        if r.Method != http.MethodPost </span><span class="cov8" title="1">{
                http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
                return
        }</span>
        
        <span class="cov8" title="1">url := r.FormValue("url")
        if url == "" </span><span class="cov8" title="1">{
                http.Error(w, "URL parameter is required", http.StatusBadRequest)
                return
        }</span>
        
        <span class="cov8" title="1">result := s.analyzer.AnalyzeURL(url)
        
        w.Header().Set("Content-Type", "application/json")
        if err := json.NewEncoder(w).Encode(result); err != nil </span><span class="cov0" title="0">{
                log.Printf("JSON encoding error: %v", err)
                http.Error(w, "Internal Server Error", http.StatusInternalServerError)
                return
        }</span>
}

const indexHTML = `
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Web Page Analyzer&lt;/title&gt;
    &lt;link rel="stylesheet" href="/static/css/styles.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;div class="main-content"&gt;
            &lt;div class="header"&gt;
                &lt;h1 class="title"&gt;Web Page Analyzer&lt;/h1&gt;
                &lt;p class="subtitle"&gt;Analyze web pages for HTML structure, content, and accessibility&lt;/p&gt;
            &lt;/div&gt;
            
            &lt;div class="card"&gt;
                &lt;form id="analyzeForm"&gt;
                    &lt;div class="form-group"&gt;
                        &lt;label for="url" class="form-label"&gt;Enter URL to analyze&lt;/label&gt;
                        &lt;input type="url" id="url" name="url" class="form-input" required placeholder="https://example.go"&gt;
                    &lt;/div&gt;
                    &lt;button type="submit" id="submitBtn" class="btn btn-primary"&gt;Analyze Page&lt;/button&gt;
                &lt;/form&gt;
                
                &lt;div id="results" class="results"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src="/static/js/app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;`
</pre>
		
		<pre class="file" id="file2" style="display: none">package main

import (
        "log"
        "net/http"
        "os"

        "web-page-analyzer/handlers"
)

func main() <span class="cov0" title="0">{
        port := os.Getenv("PORT")
        if port == "" </span><span class="cov0" title="0">{
                port = "8080"
        }</span>

        <span class="cov0" title="0">server := handlers.NewServer()

        // Serve static files
        fs := http.FileServer(http.Dir("static"))
        http.Handle("/static/", http.StripPrefix("/static/", fs))
        
        // Serve application routes
        http.HandleFunc("/", server.IndexHandler)
        http.HandleFunc("/analyze", server.AnalyzeHandler)

        log.Printf("Server starting on port %s", port)
        log.Printf("Visit http://localhost:%s to use the application", port)
        
        if err := http.ListenAndServe(":"+port, nil); err != nil </span><span class="cov0" title="0">{
                log.Fatal("Server failed to start:", err)
        }</span>
}</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
